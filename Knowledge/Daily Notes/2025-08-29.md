# 2025-08-29  

## 📅 Overview
- **Day:** Friday  
- **Week:** 35  
- **Mood:** 😃 / 😐 / 😞  
- **Focus of the day:** ...



# Checkers 



# Inventory System
##### SubscriptionAgent
There are multiple azure org accounts in the database and an AWS org account. So we need some level of abstraction to handle each login. This object can be created upon startup as we will have a mapping for all the logins. 




##### ResourceManager
ResourceManager - abstract
- NetworkResourceManager
- SubnetResourceManager
- VMResourceManager

Each resource manager can take an account_id and a cloud type. In the constructor, it will make a call to the DB and grab each of the cloud resource type ids. So, if we are a network resource manager, we will grab all the networks in the database. We grab them because when we are inventorying new networks, we need to keep track of which previously inventoried networks will be deleted. We will store all the network ids in a set. 

Then each will have a run function, inside the run function, essentially it will grab all the networks from boto3 and start storing them in the database if they are not found. If they are found we will update them. As we find records we will remove from the set of previously inventoried resource ids. So by the end of run() function, we will know which resources were deleted because they will still be in the set. 



We may need to perform multiple 

##### is_last flag
- each record will have an is_last flag, if it is 1 that means the record is active and in use, if not then it is deleted
  
##### ChatGPT Suggested Architecture


### ResourceManager Architecture

The **ResourceManager** pattern organizes cloud inventorying into clear layers:

- **ResourceManager (abstract orchestrator)**
  - Central workflow controller.
  - Steps:
    1. **Load existing state** → query database for already inventoried resources.
    2. **Fetch current state** → call cloud provider APIs for live resources.
    3. **Reconcile differences** → figure out which are new, updated, or deleted.
    4. **Apply changes** → persist adds/updates/deletes back to the database.
  - Specializations: `NetworkResourceManager`, `SubnetResourceManager`, `VMResourceManager`.

- **Repository (DB layer)**
  - Encapsulates database operations.
  - Handles CRUD (create, read, update, delete) for a specific resource type.
  - Example: `NetworkRepository.get_all(account_id)`

- **Fetcher (Cloud API layer)**
  - Abstracts away AWS/Azure SDKs.
  - Responsible for retrieving raw cloud data and converting it into normalized objects.
  - Example: `NetworkFetcher.fetch(account_id)`

- **Reconciler (Diff logic)**
  - Compares existing DB records with fetched cloud records.
  - Produces sets of `{to_add, to_update, to_delete}`.

---

**Data Flow**

```text
[Cloud Provider] --(Fetcher)--> [ResourceManager] <--(Repository)-- [Database]
                                       |
                                       v
                                  (Reconciler)
